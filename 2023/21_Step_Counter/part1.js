// Day 21: Step Counter - Part 1
// https://adventofcode.com/2023/day/21

var stepCounter = function (input, todaySteps) {
  const [grid, rows, columns] = getData(input);
  const start = findStartingPoint(grid);
  const DIRS = [0, 1, 0, -1, 0];

  let steps = 0;
  let queue = new Set([toCell(...start)]);
  while (queue.size && steps < todaySteps) {
    steps++;
    const nextQueue = new Set();
    for (const cell of queue) {
      const [row, column] = toPoint(cell);
      for (let d = 0; d < 4; d++) {
        const [nextRow, nextColumn] = [row + DIRS[d], column + DIRS[d + 1]];
        if (nextRow < 0 || nextRow >= rows || nextColumn < 0 || nextColumn >= columns) continue;
        if (grid[nextRow][nextColumn] === '#') continue;

        const nextCell = toCell(nextRow, nextColumn);
        nextQueue.add(nextCell);
      }
    }
    queue = nextQueue;
  }

  return queue.size;

  function getData(input) {
    const grid = input.split(/\n/).map((line) => line.split(''));
    const rows = grid.length;
    const columns = grid[0].length;
    return [grid, rows, columns];
  }

  function findStartingPoint(grid) {
    const rows = grid.length;
    const columns = grid[0].length;
    for (let row = 0; row < rows; row++) {
      for (let column = 0; column < columns; column++) {
        if (grid[row][column] === 'S') return [row, column];
      }
    }
  }

  function toCell(row, column) {
    return row * columns + column;
  }
  function toPoint(cell) {
    const column = cell % columns;
    const row = (cell / rows) >> 0;
    return [row, column];
  }
};

console.time('day-21_part-1');

var input = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`,
  todaySteps = 6;
var expected = 16;
var result = stepCounter(input, todaySteps);
console.log(result, result === expected);

var input = `...................................................................................................................................
......#.....#.........#.....#.#...#.##.......#.#........#..#..................#.#...........#............#.#....##..#........#.....
...#.......#....#.#......#..#.......#.....#................................#...#......#.......................#...#........#.......
....#..#...#......................#............#........................#.#.............#.#....#........#...........#.#......##.#..
.......#.....#.......#.....#.........#....#...#......................................#...#.##....#.....................#...#.......
..#....................................#..........##..............#........#...#.........###................#........#....#...#..#.
....#.....................#.....#.#............#.#.................#.............#...........#..#..........##.............#........
..#..#...#..............##.........#...........#......#.........#.................................#...#.......#.#..#...............
..#....#..#...#.#.#.......##......#.#..#.....##.#................................###..#....#................#...........#..#....#..
..#......#...........#..........#..................#........#......#.#.............................#..#..............#...#.....#...
.............##.#............#....#.#....#.#.##.................#..#...#.......#.................#....#............#...#...........
.............##...............#...#.#..###....##..................#.................#..............#....#.#.......#..#.#........#..
..................................#...##.#.................#....................................##..................#.##.#.....#.#.
...#............#.....#....#.......#.#........#.........#..##..#....................###........................#....#........#.....
.................#.#......#.......#..#...#.#.......................#..#.............###...##.#...#...#.#..#...#....................
.................#..#..#.#........#.....#.............#.#...........#.......#.........#............................#....#.#........
....#.......#.....#....#.#..#....#...#..#............#.##.........#...#.....#........#...............#.................#.##....#...
..#....................##...#......###.................#....#.........#...............................#....##..........#........#..
...#.....#........#.....#.#.........#.##................#.#...#....#.#...#...#.................#...........#....#.#...#.....#....#.
..#...###.....#.......#......#..........#................................................#.......#.#.........#...#.................
......##...##...............#...##....................#.............#....................#........#.#..........................#.#.
...#.......#..##...#.....................................#..##......#.#..#........................#.#...................#....#.....
.....#...#...................#.....#.#..........#......#.......#....#....#..#...#..........#.....#...............#.................
..#.#...................#..#....................#....#..#......#....###.......#........................#.##.......#.......#.....#..
.#....#......#..#..#..............#................##...........#........#...#.#...............#.#....#....................#.......
.....#.....#..#............#......................#.........#...#...................................#...........###.......#......#.
.#.......................#...#................#....................#.............#..............#...#.#......#........#........#.#.
.....#.#.#.#......#..............#..............#.........#...........#.##.##...........#............#.............#...#....#.#....
.............#......#..........#.....................#...............#...........#..........................##....##...............
..#............#.........#...............#..##.#.......#....#.......###...............#.......................#..##..#...#.#...#...
..#...#....#.......................................#.................#.##..##....#..................##..........#.#.........#......
.#.......#..................###........#......#............#.................#...#.##..#....................#..................#...
.......#....#..........#.#...........#...#.#.....#....##.##..#.#...........##......#.#.................#....................#......
..#..#...#.........#....#.............#...#.#.....##..............##........#.#.......................#..............#...#....#.#..
.....................#..................#..####..........................#.#.....#...#...................................###...#...
..#.#....#........#......#..........#..................#...#...#..........#.##...........#....###.............#...........#....#...
.#.................#.....#...........#....#....#.....#....#.....#..##.#.............#.......#................#......#..............
...........#..##....##.......................#..#....#...#..............#.....#...##...#..#...#..............................#.....
.##...#..........#...#..........#......#.........#.#...............##............#......#..#.......#...........#.#.........#.......
..............#........................#......#...............#..........#.#...#.....##........................#........#...#......
..#.............#..............#....#....##..#...............#.#..........#....##.#.............................#........#......##.
.......................................#........#..........#..........#..#.#........#..............#..........#.......#.........#..
....#.......#.....#...............#....#..........#......##.........#.##.##..........##.##..#........#..................#...#......
...........................#................#............#...#...................#..###................#...........#.#.............
...#.#.......#.................##.#.........#..#.#............##.......#..................#..........#..#.................#.#..##..
......................................#.............#.......#.....#..#.........................#....#.....#..........#.............
......#..#...##..............#.....#.............#.........#.#.................#...#...#......#...#..................#...#....#....
..............................#.....#....#...#.#......#..............#..........#.#...........##..........##...............###.....
.....#.............................#................#.#...#.........#............#.......#......#...#....#.................#.#.....
........#............##......#..........#............................#.....#..................#...#.#.####.................#.......
.......#.###...............##...##.......##........#...............#.............#.#.............#......#..#...........#......#.#..
.#...#..#.#...............#..#.....#.........................#.......................#.....#.....#......#.................#...##...
......#................................#.......#...................................................................................
.#..#...#.......#.....#............#.#..#....#............#.............#..#.......#.#....#....#..#.....#........#.........#.......
..#.................#....##..#........#..........#.....#...#...#............#..#...#.......#....#.....#..#.....#...........#.......
......#...................#.##............#................#...#..#.#......#......................##......#.....#..................
........................#..#.........#.......#...........#...#.........##..##......................#........#.#..##..............#.
............#.#..#.....#.#.#.....#.....#......#...#..........................#..#............#.................#..#.#.........#....
............#.#..#..............................#...........##...........#...#...........#...........#.#..#....#.#.................
..#.......#.....#...............##.....#..........................#............#.#.##.....##....#....#......#....####............#.
...................................#.....#..#.#.#.........#....#..........................##....#.#.#.....#...........#............
...........#...............................................#.#..................#........#......#.......#...#..#....#..#...........
...........#.#........#....#.##.#..#.#.#....#..#.#.............#.................#...#.#...........#............#......#...........
...........#....##..##........##.......#..........#..........###....###..##...........#.#.........#.#...#..........................
.....#...#...##...#......#.........#..#.................#...............................#...............#....#.............##......
.................................................................S.................................................................
..............##....##.##...........#............#.#..#.....#..........#..#..#..#...##....#..................#......#......#.......
........#...........#...........#.#...#...#...........#...#...##...##..#......#.........#...#..#........#.......#..#....#..........
............#.#....#...##......#......#.........#...#.#..............#..#.#.........#.....#....#........#..........................
...........#...##..........#..##...#..#..........#...#..##..#.....#...............#.#............#.#.#..........#....##............
................#.......#.............#..#.........#.#...#...##.............##.........#......................#........#...........
.#................#.#................##...#....##.................#......#..#.#........#.........#.....#.#..#...##......#..........
............#...........#..#.....#....##..#.................................#...#.....#...#....#...##.....#......#...##.........##.
...#.....................#......#....##.......................#....#.#...............#........#..#......#............#.............
...#.#........#.....................#...........#..#.....#......#....#......##......................#..#..#..#.##..#.........#..#..
................#................#..#........#............##.#...................................#..#..............................
.................#..............#......................##............#......#..#..#...#.....................#..#.#.#.............#.
.#...#..#..............#.#.......#........#..#..........#......#...#....#.#....#.........#......#.....##......................#....
....#..#...........#.#..............#.........#..##.................#.#....#..........#..#.........##..........#............##..#..
..#.#.#............#.........#..#......##.....##..#...............#........#...........#...................#..#..................#.
....#....................#.##.....#...#......##.#.............#......#....#.........................#.........#....................
.....#......................#.#..#......#.......#.....#.............#.....#.............#.#.........#.#......#.............#.......
...#.#..#.................#.....#...........#........#....#...#........##.........#...#.....#..#.....#..#.#..................#.....
...##..#.##.#...........#.....................................#...............#...................##......#.#.........#......#..#..
....#..................#...#....#............#............#...#............#..#.........#...............#.#.........#..............
...........#..............#........#........#.#....................#..#....#..............................#........................
..#....#.#..#..#..........#.#.##..#..#..##....#.#..#....................#............#....#...#..................#...#......#......
.....####......#.#...............#.....#...........................#......#.............#.......#.............................#....
.....#.........................#............#.#......##.....##.........##...........###.....#......##.##.............#......#.#....
....#...............................##...#......#...#.......#................#...#..............#..............###.................
..........#.#.#......#.......#...##.....#....#.............#..##.........................#.........#..................#............
...........#.#......#.........#.......#.#..............#.#...........#................#...................................##.......
.#.....................................#.....#........#.#..#..........#...#..........#.#.......###..........#....#..#.#....#.#.....
.....#.....#.....................#..#.......#....#....###.#.#........##.........#.............##..#..............#....#......#.#...
.....#..#..###.#..#................#...##.......#.....#......##.............####.....#....#.............................#..........
....#.##.........##.......#.......#.......#.#.........##................##...#................#.........#......#.#.#......#........
.#.....#.............................#..............#...........#.#........#......#..#...................#.#.........#...#.........
..........#.###..#.....................#.......#...........#............##.........##.........#........#.........#......#....###...
........#....##.##........#..................#....##.#...#.........#......#...#............#...................#..#.............#..
.#..#.............................................#..................................#......................#...#............##.#..
........................#.....#.............#.....#..........#..#.......#...#...#..##..............#..........#...#............#.#.
.....#....#...#....#..#........................#....##.......#.#...#....###............#.#............#.........#..................
......#......#...#..#.......#...............##...#...........#..........#.........#...#...............##................#........#.
.................#.##...#.#...............#.......#..........#..#.........#...#..###.............#.........#.........##............
..#....#.........................#.#........#.#...........#..........#....#............#.................##....#...................
...........#....#.............#.....................#.....###.......#...#...#...#.......................#..#.##.......#.......#....
.#.............#....#....#........#...........#.......................#......#..................#..#.....#.#..#..#........##.......
.#.....#.....##...#........#.........#...............#.#..........#...#...#...........................##..##...#....#.......#......
....#..#......#.....#.###..#.##.......................###.....................#................##..................................
.................#.#.....##..##.......#.#........#........#........##........#....#..........#.....#......#.............#........#.
....................#.......#..#....................#..#........#.#.........................................#.##...................
.....#....#....#.......#....#....#........#................#....#....#........#............................#......#.#......#..#....
.............##....#...#................#..........#...........#...#....#.....##........#.#..#.......#..#....#....#..#.#.....##....
.......#......#..#...#....#..#.........#...............#...#.#..........................#.#.....#.....#.#.............#............
.....#................#..........#.#.##.#.#...............................#........................#.##..........#.........##.#.#..
.....#........#.....##...........#...#........................##........#.............#......#.................##..................
.........................#.....#.......#.#..#..#..........#.#..#........#.##......................#....................#...#.#.....
...........#..#.###........#...........#....#..#........#.......#.......#...........................#....#.....#..#....##...#......
....#..............................#.......................#.......#.#.......................#.......#..#.........#..............#.
......#.#......#..#..#...#.......#..............##.....................................#.............###.....#.......#..#.#......#.
.....#..#..............#.........#........#..#....................#..#.........#.........#.....#....#.....#......#.................
...#...........##...#.......##.#...#...#.....#...................................#.......#......###.....##............#..##........
.....#...........#................#....#...#...#.##..............................#.......#..#.........#.....#..#.....#..#...#...#..
...#..............#.....##.......#.....#.......................................##.......##.....#...................###.....#.......
......#..##..#...#........#.............##..#.......#.........................#.#..........#..............#......................#.
...............#.........#..##..........#...#.#...#.#.#....................#.....................#...#..##....#....#..#.........#..
.........#....#..#........#............................#....................#.#.........#.........................#...........#.#..
......#....................##......#....##................................#.....#...#...............#............#...#..#.#.....#..
......#.#.....#.........#.....................................................#......#................#............#..........#....
...............#..#......#....#............#..........##...#............#..................##......................................
...................................................................................................................................`,
  todaySteps = 64;
var expected = 3731;
var result = stepCounter(input, todaySteps);
console.log(result, result === expected);

console.timeEnd('day-21_part-1');
